alter system switch logfile ;

select a.group#, a.member, b.bytes/1024/1024, b.status
from v$logfile a, v$log b
where a.group#=b.group#;


alter database add logfile group 3 size 200M;
alter database add logfile group 4 size 200M;
alter database add logfile group 5 size 200M;
alter system switch logfile;
alter system switch logfile;
alter system switch logfile;
alter database drop logfile group 1;
alter database drop logfile group 2;


##activar archive log mode

shutdown immediate;
startup mount
alter database archivelog;
alter database open;
archive log list;
exit;

## activar log miner
ALTER DATABASE ADD SUPPLEMENTAL LOG DATA (ALL) COLUMNS;
ALTER PROFILE DEFAULT LIMIT FAILED_LOGIN_ATTEMPTS UNLIMITED;
exit;

# Create Log Miner Tablespace and User
CREATE TABLESPACE LOGMINER_TBS DATAFILE '/u01/app/oracle/oradata/XE/logminer_tbs.dbf' SIZE 25M REUSE AUTOEXTEND ON MAXSIZE UNLIMITED;

CREATE USER c##dbzuser IDENTIFIED BY dbz DEFAULT TABLESPACE LOGMINER_TBS QUOTA UNLIMITED ON LOGMINER_TBS;

GRANT CREATE SESSION TO c##dbzuser ;
grant select on v_$database to c##dbzuser;
GRANT FLASHBACK ANY TABLE TO c##dbzuser ;
GRANT SELECT ANY TABLE TO c##dbzuser ;
GRANT SELECT_CATALOG_ROLE TO c##dbzuser ;
GRANT EXECUTE_CATALOG_ROLE TO c##dbzuser ;
GRANT SELECT ANY TRANSACTION TO c##dbzuser ;
GRANT SELECT ANY DICTIONARY TO c##dbzuser ;
#GRANT LOGMINING TO c##dbzuser ;
GRANT CREATE TABLE TO c##dbzuser ;
GRANT ALTER ANY TABLE TO c##dbzuser ;
GRANT LOCK ANY TABLE TO c##dbzuser ;
GRANT CREATE SEQUENCE TO c##dbzuser ;

GRANT EXECUTE ON DBMS_LOGMNR TO c##dbzuser ;
GRANT EXECUTE ON DBMS_LOGMNR_D TO c##dbzuser ;

GRANT SELECT ON V$LOGMNR_LOGS TO c##dbzuser ;
GRANT SELECT ON V$LOGMNR_CONTENTS TO c##dbzuser ;
GRANT SELECT ON V$LOGFILE TO c##dbzuser ;
GRANT SELECT ON V$ARCHIVED_LOG TO c##dbzuser ;
GRANT SELECT ON V$ARCHIVE_DEST_STATUS TO c##dbzuser ;


CREATE USER debezium IDENTIFIED BY dbz;
  GRANT CONNECT TO debezium;
  GRANT CREATE SESSION TO debezium;
  GRANT CREATE TABLE TO debezium;
  GRANT CREATE SEQUENCE to debezium;
  ALTER USER debezium QUOTA 100M on users;